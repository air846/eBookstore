# 小程序端开发计划

## 1. 项目目标

在现有 eBookstore（后端 + 用户端 Web + 管理端）基础上，新增**小程序端**，复用后端用户侧 API，使读者可在微信等平台通过小程序完成登录、浏览、阅读与收藏，形成多端可用的阅读体验，并通过分阶段交付保证可追溯。

**范围说明**：以**微信小程序**为首发平台；若采用 uni-app / Taro 等跨端方案，可后续扩展至支付宝小程序、H5 等。

---

## 2. 与现有架构的关系

- **后端**：不新增接口，复用现有用户端 API（`/api/user/**`、`/api/book/**`、`/api/category/**`、`/api/carousel/**`）。
- **鉴权**：与 Web 用户端一致，使用 JWT；小程序端在请求头携带 `Authorization: Bearer <token>`。
- **账号体系**：与 Web 用户端共用同一套用户表与登录态，同一账号可在 Web 与小程序同时使用（各自 token 独立）。

---

## 3. 技术选型建议

| 方案 | 优点 | 适用场景 |
|------|------|----------|
| **微信小程序原生** | 官方支持最好、包体可控、无额外运行时 | 只做微信小程序 |
| **uni-app** | Vue 语法、一套代码多端（微信/支付宝/H5）、与现有 Vue 技术栈接近 | 考虑多端或团队偏 Vue |
| **Taro** | React/Vue 可选、多端一致、组件丰富 | 偏 React 或强多端 |

**推荐**：若团队以 Vue 为主，优先 **uni-app**，便于与 library-user 共享接口封装与业务理解；若仅做微信且追求最小依赖，选**微信小程序原生**。

---

## 4. 功能范围（MVP）

小程序端 MVP 覆盖「读者在手机上完成核心阅读动线」，不做管理能力。

| 模块 | 功能点 | 对应后端接口 |
|------|--------|--------------|
| 认证 | 微信授权登录（或手机号快捷登录）、注册/绑定、退出 | `POST /api/user/login`、`GET /api/user/info`、`POST /api/user/logout`，可选 `POST /api/user/register` |
| 首页 | 轮播图、热门/新书推荐入口 | `GET /api/carousel/list`、`GET /api/book/list`（sortBy/order） |
| 书库 | 分类筛选、关键词搜索、分页列表 | `GET /api/category/tree`、`GET /api/book/list` |
| 详情 | 封面、书名、作者、简介、收藏状态、阅读按钮 | `GET /api/book/detail/{id}`、`POST/DELETE /api/book/favorite/{bookId}` |
| 阅读器 | 章节列表、正文阅读、进度记忆、基础设置（字号/夜间） | `GET /api/book/read/{id}`、`GET /api/book/{id}/chapters`、`POST /api/book/history`、`GET /api/book/history/list` |
| 书架 | 我的收藏列表、跳转详情/阅读 | `GET /api/book/favorite/list` |
| 个人中心 | 头像、昵称、阅读历史入口、退出登录 | `GET /api/user/info`、阅读历史可复用 `GET /api/book/history/list` |

**首版不做**（可列入后续迭代）：段评/点赞点踩、催更、互动通知、阅读偏好统计、个人资料编辑与修改密码。若后端已有对应用户信息更新接口，可在后续版本中补充。

---

## 5. 阶段划分与交付

### 阶段 1：规划与脚手架

- 确定技术方案（原生 / uni-app / Taro）及目录规范。
- 在仓库中建立小程序工程目录（如 `miniprogram/` 或 `library-mp/`）。
- 配置请求基址、JWT 存储与请求头、统一错误与登录态处理。
- 输出本文档与接口对接说明（复用 `doc/api/接口清单.md` 用户端部分）。

交付物：

- `doc/开发计划-小程序端.md`（本文档）
- 小程序工程目录、基础配置与请求封装、README 中的运行说明

### 阶段 2：认证与首页

- 实现微信登录（wx.login + code 换 openid/unionid，与后端约定用 username 或 openid 绑定）。
- 与后端对接：登录接口返回 JWT，本地存储并后续请求携带。
- 首页：轮播图、热门/新书区块，点击进入详情或书库。

交付物：

- 登录/授权流程可跑通，token 持久化与带 token 请求
- 首页 UI 与数据联调完成

### 阶段 3：书库、详情与阅读器

- 书库：分类树、关键词搜索、分页列表、卡片式展示。
- 详情：书籍信息、收藏/取消收藏、开始阅读入口。
- 阅读器：章节列表（抽屉或单独页）、正文展示、进度上报、字号与夜间模式等基础设置。

交付物：

- 书库列表与分类/搜索联调完成
- 详情页与收藏联调完成
- 阅读器可正常阅读并保存进度

### 阶段 4：书架与个人中心

- 书架：展示收藏列表，支持跳转详情与继续阅读。
- 个人中心：展示用户信息（头像、昵称）、阅读历史入口、退出登录。
- 统一处理未登录态：需登录的页面拦截并跳转登录。

交付物：

- 书架与个人中心页面完成
- 登录态校验与未登录跳转一致

### 阶段 5（可选）：优化与发布

- 性能：列表分页与图片懒加载、请求防抖与缓存策略。
- 体验：加载骨架屏、错误提示与重试、下拉刷新。
- 提交微信审核与发布（需备案域名与 HTTPS 后端）。

交付物：

- 体验与性能优化说明
- 小程序发布检查清单（类目、隐私协议、服务器域名等）

---

## 6. 里程碑与提交策略

建议 Git 提交与标签：

- `feat(mp): phase1 小程序端规划与脚手架、请求与鉴权封装`
- `feat(mp): phase2 小程序端登录与首页联调`
- `feat(mp): phase3 小程序端书库、详情与阅读器`
- `feat(mp): phase4 小程序端书架与个人中心`
- `feat(mp): phase5 小程序端优化与发布准备`（可选）

---

## 7. 验收标准（MVP）

- 用户可在小程序内完成微信授权登录并获取稳定登录态。
- 首页可展示轮播与推荐书籍，并进入书库或详情。
- 书库支持按分类、关键词筛选与分页浏览。
- 详情页可展示书籍信息、收藏/取消收藏，并进入阅读。
- 阅读器可展示章节与正文、记忆进度，并具备基础阅读设置（如字号、夜间模式）。
- 书架可展示收藏列表并跳转详情/阅读。
- 个人中心可展示用户信息与阅读历史入口，并支持退出登录。
- 所有需登录能力均依赖同一套 JWT 与后端用户端 API，与 Web 用户端账号互通。

---

## 8. 目录结构建议

在现有仓库中增加小程序工程，例如：

```text
eBookstore/
├─ backend/
├─ library-user/
├─ library-admin/
├─ library-mp/              # 或 miniprogram/：小程序端（uni-app / 微信原生 等）
│   ├─ pages/
│   ├─ static/
│   ├─ utils/               # 请求封装、storage、常量
│   ├─ app.js / app.json / app.vue 等（视技术栈而定）
│   └─ README.md
└─ doc/
   ├─ 开发计划.md
   ├─ 开发计划-小程序端.md
   └─ api/接口清单.md
```

---

## 9. 后端与运维注意点

- **域名与 HTTPS**：小程序要求请求必须走 HTTPS，需为 API 配置正式域名并在微信后台配置 request 合法域名。
- **登录态**：若采用微信 code 换 session 再换 JWT，需在后端增加一档「小程序登录」接口（接收 code 或 openid），与现有 `POST /api/user/login` 可并存；若首版采用「账号密码登录」与 Web 一致，则无需改后端，仅需保证 CORS 或域名配置不阻挡小程序请求（小程序无 CORS 限制，仅受合法域名约束）。
- **内容安全**：书籍内容、评论若在小程序内展示，需注意微信内容安全与类目要求，必要时对接内容安全接口。

以上为小程序端开发计划，可与主项目《开发计划》并行推进，按阶段提交即可追溯进度。
